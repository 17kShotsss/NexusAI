<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexus AI - Advanced Assistant</title>

<!-- Prism.js CSS for syntax highlighting -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  /* Dark Theme */
  --bg-primary: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
  --bg-secondary: rgba(26, 26, 46, 0.95);
  --bg-surface: rgba(52, 69, 99, 0.1);
  --bg-glass: rgba(255, 255, 255, 0.05);
  --bg-hover: rgba(255, 255, 255, 0.08);
  --bg-active: rgba(0, 212, 255, 0.1);
  --text-primary: #ffffff;
  --text-secondary: #a0a0b8;
  --text-muted: #6b6b82;
  --accent-primary: #00d4ff;
  --accent-secondary: #ff006e;
  --accent-gradient: linear-gradient(135deg, #00d4ff 0%, #ff006e 100%);
  --border-color: rgba(255, 255, 255, 0.1);
  --border-glow: rgba(0, 212, 255, 0.3);
  --shadow-glow: 0 0 30px rgba(0, 212, 255, 0.2);
  --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.3);
  --blur-bg: backdrop-filter: blur(20px) saturate(1.8);
  --sidebar-width: 320px;
}

body.light {
  --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
  --bg-secondary: rgba(248, 250, 252, 0.95);
  --bg-surface: rgba(255, 255, 255, 0.8);
  --bg-glass: rgba(0, 0, 0, 0.02);
  --bg-hover: rgba(0, 0, 0, 0.05);
  --bg-active: rgba(0, 212, 255, 0.1);
  --text-primary: #1e293b;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --accent-primary: #0ea5e9;
  --accent-secondary: #e11d48;
  --border-color: rgba(0, 0, 0, 0.1);
  --border-glow: rgba(14, 165, 233, 0.3);
  --shadow-glow: 0 0 30px rgba(14, 165, 233, 0.15);
  --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  display: flex;
  height: 100vh;
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(255, 0, 110, 0.1) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

/* Animated Background Particles */
.bg-particles {
  position: fixed;
  inset: 0;
  overflow: hidden;
  pointer-events: none;
  z-index: 1;
}

.particle {
  position: absolute;
  background: var(--accent-primary);
  border-radius: 50%;
  opacity: 0.1;
  animation: float 20s infinite linear;
}

@keyframes float {
  from {
    transform: translateY(100vh) rotate(0deg);
  }
  to {
    transform: translateY(-100px) rotate(360deg);
  }
}

/* Sidebar */
.sidebar {
  width: var(--sidebar-width);
  background: var(--bg-secondary);
  backdrop-filter: blur(20px) saturate(1.8);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 100;
  position: relative;
}

.sidebar::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, 
    rgba(0, 212, 255, 0.05) 0%, 
    transparent 50%, 
    rgba(255, 0, 110, 0.05) 100%);
  pointer-events: none;
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border-color);
  position: relative;
  z-index: 2;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.logo-icon {
  width: 32px;
  height: 32px;
  background: var(--accent-gradient);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: white;
  font-size: 16px;
}

.logo-text {
  font-size: 20px;
  font-weight: 700;
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.new-chat-btn {
  width: 100%;
  padding: 16px 20px;
  background: var(--bg-glass);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  border-radius: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.new-chat-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--accent-gradient);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.new-chat-btn:hover {
  border-color: var(--border-glow);
  box-shadow: var(--shadow-glow);
  transform: translateY(-2px);
}

.new-chat-btn:hover::before {
  opacity: 0.1;
}

.new-chat-btn svg {
  width: 18px;
  height: 18px;
  fill: none;
  stroke: currentColor;
  stroke-width: 2;
  z-index: 1;
  position: relative;
}

.new-chat-btn span {
  z-index: 1;
  position: relative;
}

.chat-history {
  flex: 1;
  overflow-y: auto;
  padding: 8px 20px;
  scrollbar-width: thin;
  scrollbar-color: var(--border-color) transparent;
  position: relative;
  z-index: 2;
}

.chat-history::-webkit-scrollbar {
  width: 6px;
}

.chat-history::-webkit-scrollbar-track {
  background: transparent;
}

.chat-history::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

.chat-history-item {
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 4px;
  cursor: pointer;
  color: var(--text-secondary);
  font-size: 14px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  backdrop-filter: blur(10px);
  overflow: hidden;
}

.chat-history-item::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--bg-hover);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.chat-history-item:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
  transform: translateX(4px);
}

.chat-history-item:hover::before {
  opacity: 1;
}

.chat-history-item.active {
  background: var(--bg-active);
  color: var(--text-primary);
  border: 1px solid var(--border-glow);
  box-shadow: var(--shadow-glow);
}

.chat-history-item svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  opacity: 0.8;
  z-index: 1;
  position: relative;
}

.chat-item-content {
  flex: 1;
  overflow: hidden;
  z-index: 1;
  position: relative;
}

.chat-item-title {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  font-weight: 500;
}

.chat-item-date {
  font-size: 12px;
  opacity: 0.6;
  margin-top: 4px;
}

.delete-btn {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  padding: 6px;
  background: rgba(239, 68, 68, 0.1);
  border: none;
  color: #ef4444;
  cursor: pointer;
  opacity: 0;
  transition: all 0.3s ease;
  border-radius: 6px;
  z-index: 2;
}

.chat-history-item:hover .delete-btn {
  opacity: 1;
}

.delete-btn:hover {
  background: rgba(239, 68, 68, 0.2);
  transform: translateY(-50%) scale(1.1);
}

.delete-btn svg {
  width: 14px;
  height: 14px;
}

.sidebar-footer {
  padding: 20px;
  border-top: 1px solid var(--border-color);
  position: relative;
  z-index: 2;
}

.sidebar-footer button {
  width: 100%;
  padding: 12px 16px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  border-radius: 10px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.sidebar-footer button:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
  transform: translateX(4px);
}

.sidebar-footer button svg {
  width: 18px;
  height: 18px;
}

/* Main Content */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: transparent;
  position: relative;
  z-index: 10;
}

.header {
  padding: 20px 32px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(1.8);
  position: relative;
}

.header::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, 
    rgba(0, 212, 255, 0.05) 0%, 
    transparent 50%, 
    rgba(255, 0, 110, 0.05) 100%);
  pointer-events: none;
}

.header-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 1;
  position: relative;
}

.status-indicator {
  width: 8px;
  height: 8px;
  background: #10b981;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.header-actions {
  display: flex;
  gap: 8px;
  z-index: 1;
  position: relative;
}

.icon-btn {
  padding: 12px;
  background: var(--bg-glass);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: 12px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.icon-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
  border-color: var(--border-glow);
  transform: translateY(-2px);
  box-shadow: var(--shadow-soft);
}

.icon-btn svg {
  width: 20px;
  height: 20px;
}

/* Chat Container */
.chat-container {
  flex: 1;
  overflow-y: auto;
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: var(--border-color) transparent;
}

.chat-container::-webkit-scrollbar {
  width: 8px;
}

.chat-container::-webkit-scrollbar-track {
  background: transparent;
}

.chat-container::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;
}

.chat-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 32px 24px;
}

.message-wrapper {
  margin-bottom: 32px;
  animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message {
  display: flex;
  gap: 16px;
  padding: 24px;
  border-radius: 20px;
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(1.8);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.message::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--bg-hover);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.message:hover::before {
  opacity: 1;
}

.message-wrapper.user .message {
  background: linear-gradient(135deg, 
    rgba(0, 212, 255, 0.1) 0%, 
    rgba(0, 212, 255, 0.05) 100%);
  border-color: rgba(0, 212, 255, 0.2);
}

.message-wrapper.ai .message {
  background: linear-gradient(135deg, 
    rgba(255, 0, 110, 0.1) 0%, 
    rgba(255, 0, 110, 0.05) 100%);
  border-color: rgba(255, 0, 110, 0.2);
}

.avatar {
  width: 44px;
  height: 44px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 16px;
  font-weight: 700;
  position: relative;
  z-index: 1;
}

.avatar.user {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.avatar.ai {
  background: var(--accent-gradient);
  color: white;
  box-shadow: var(--shadow-glow);
}

.message-content-wrapper {
  flex: 1;
  z-index: 1;
  position: relative;
}

.message-content {
  color: var(--text-primary);
  line-height: 1.7;
  font-size: 15px;
  word-break: break-word;
}

.message-actions {
  display: flex;
  gap: 8px;
  margin-top: 16px;
  opacity: 0;
  transition: all 0.3s ease;
  transform: translateY(4px);
}

.message-wrapper:hover .message-actions {
  opacity: 1;
  transform: translateY(0);
}

.action-btn {
  padding: 8px 12px;
  background: var(--bg-glass);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  backdrop-filter: blur(10px);
}

.action-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
  border-color: var(--border-glow);
  transform: translateY(-1px);
}

.action-btn svg {
  width: 14px;
  height: 14px;
}

/* Enhanced Code Block */
.code-block {
  background: rgba(0, 0, 0, 0.8);
  color: #f8f8f2;
  padding: 0;
  border-radius: 16px;
  position: relative;
  font-family: 'JetBrains Mono', 'Consolas', 'Monaco', 'Courier New', monospace;
  overflow: hidden;
  margin: 16px 0;
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.code-lang {
  font-size: 12px;
  color: var(--accent-primary);
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 1px;
}

.copy-btn {
  padding: 6px 12px;
  font-size: 12px;
  border: 1px solid rgba(0, 212, 255, 0.3);
  border-radius: 6px;
  cursor: pointer;
  background: rgba(0, 212, 255, 0.1);
  color: var(--accent-primary);
  transition: all 0.3s ease;
  font-weight: 500;
}

.copy-btn:hover {
  background: rgba(0, 212, 255, 0.2);
  border-color: rgba(0, 212, 255, 0.5);
  transform: scale(1.05);
}

.code-block pre {
  padding: 20px;
  margin: 0;
  overflow-x: auto;
}

/* Input Area */
.input-container {
  border-top: 1px solid var(--border-color);
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(1.8);
  position: relative;
}

.input-container::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, 
    rgba(0, 212, 255, 0.05) 0%, 
    transparent 50%, 
    rgba(255, 0, 110, 0.05) 100%);
  pointer-events: none;
}

.input-wrapper {
  max-width: 900px;
  margin: 0 auto;
  padding: 32px 24px;
  position: relative;
  z-index: 1;
}

.input-area {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  background: var(--bg-glass);
  border: 2px solid var(--border-color);
  border-radius: 24px;
  padding: 16px 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(20px) saturate(1.8);
  position: relative;
  overflow: hidden;
}

.input-area::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--accent-gradient);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.input-area:focus-within {
  border-color: var(--border-glow);
  box-shadow: var(--shadow-glow);
  transform: translateY(-2px);
}

.input-area:focus-within::before {
  opacity: 0.05;
}

#input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: var(--text-primary);
  font-size: 16px;
  resize: none;
  max-height: 200px;
  line-height: 1.6;
  font-family: inherit;
  z-index: 1;
  position: relative;
}

#input::placeholder {
  color: var(--text-muted);
}

.send-btn {
  padding: 12px;
  background: var(--accent-gradient);
  border: none;
  border-radius: 16px;
  cursor: pointer;
  color: white;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 20px rgba(0, 212, 255, 0.3);
  z-index: 1;
  position: relative;
}

.send-btn:hover:not(:disabled) {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 12px 30px rgba(0, 212, 255, 0.4);
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.send-btn svg {
  width: 22px;
  height: 22px;
}

/* Enhanced Typing Animation */
.typing-indicator {
  display: flex;
  gap: 6px;
  padding: 12px 0;
  align-items: center;
}

.typing-dot {
  width: 10px;
  height: 10px;
  background: var(--accent-primary);
  border-radius: 50%;
  animation: typingPulse 1.8s infinite ease-in-out;
  box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingPulse {
  0%, 60%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  30% {
    opacity: 1;
    transform: scale(1.2);
  }
}

/* Mobile Responsive */
@media (max-width: 768px) {
  :root {
    --sidebar-width: 280px;
  }
  
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    transform: translateX(-100%);
    z-index: 1000;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    z-index: 999;
    backdrop-filter: blur(4px);
  }
  
  .overlay.show {
    display: block;
  }
  
  .header {
    padding: 16px 20px;
  }
  
  .input-wrapper {
    padding: 20px 16px;
  }
  
  .chat-inner {
    padding: 20px 16px;
  }
  
  .message {
    padding: 20px;
  }
}

/* Welcome Screen */
.welcome-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
  padding: 40px;
}

.welcome-icon {
  width: 80px;
  height: 80px;
  background: var(--accent-gradient);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 24px;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.welcome-title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 12px;
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.welcome-subtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin-bottom: 32px;
  max-width: 600px;
  line-height: 1.6;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  max-width: 800px;
  width: 100%;
}

.feature-card {
  background: var(--bg-glass);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.feature-card:hover {
  transform: translateY(-4px);
  border-color: var(--border-glow);
  box-shadow: var(--shadow-glow);
}

.feature-icon {
  width: 48px;
  height: 48px;
  background: var(--accent-gradient);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 16px;
}

.feature-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.feature-description {
  color: var(--text-secondary);
  line-height: 1.5;
}
</style>
</head>
<body>

<!-- Background Particles -->
<div class="bg-particles" id="particles"></div>

<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">N</div>
      <div class="logo-text">Nexus AI</div>
    </div>
    <button class="new-chat-btn" onclick="newChat()">
      <svg viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-linecap="round"/></svg>
      <span>New Chat</span>
    </button>
  </div>
  <div class="chat-history" id="history"></div>
  <div class="sidebar-footer">
    <button onclick="clearAll()">
      <svg fill="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
      Clear History
    </button>
    <button onclick="toggleTheme()">
      <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
      <span id="theme-text">Light Mode</span>
    </button>
  </div>
</div>

<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<div class="main">
  <div class="header">
    <div class="header-title">
      <button class="icon-btn mobile-menu" onclick="toggleSidebar()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <div class="status-indicator"></div>
      Nexus AI Assistant
    </div>
    <div class="header-actions">
      <button class="icon-btn" onclick="exportChat()" title="Export Chat">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
      </button>
      <button class="icon-btn" onclick="toggleTheme()" title="Toggle Theme">
        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
      </button>
    </div>
  </div>
  
  <div class="chat-container" id="chat">
    <div class="chat-inner" id="chat-inner">
      <!-- Welcome screen will be inserted here -->
    </div>
  </div>
  
  <div class="input-container">
    <div class="input-wrapper">
      <div class="input-area">
        <textarea id="input" placeholder="Ask me anything..." rows="1"></textarea>
        <button class="send-btn" onclick="sendMessage()" id="send-btn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Prism.js -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>

<script>
// Animated background particles
function createParticles() {
  const container = document.getElementById('particles');
  const particleCount = 15;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.width = particle.style.height = Math.random() * 4 + 2 + 'px';
    particle.style.animationDuration = Math.random() * 10 + 15 + 's';
    particle.style.animationDelay = Math.random() * 10 + 's';
    container.appendChild(particle);
  }
}

// Initialize particles
createParticles();

const chatInner = document.getElementById('chat-inner');
const inputField = document.getElementById('input');
const historyDiv = document.getElementById('history');
const sendBtn = document.getElementById('send-btn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');

let conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
let currentConversationId = localStorage.getItem('currentConversationId') || null;
let currentConversation = [];
let isTyping = false;

// Initialize or load current conversation
if (currentConversationId && conversations.find(c => c.id === currentConversationId)) {
  currentConversation = conversations.find(c => c.id === currentConversationId).messages;
} else {
  currentConversationId = generateId();
  currentConversation = [];
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

// Show welcome screen if no messages
function showWelcomeScreen() {
  if (currentConversation.length === 0) {
    chatInner.innerHTML = `
      <div class="welcome-screen">
        <div class="welcome-icon">
          <svg width="40" height="40" fill="white" viewBox="0 0 24 24">
            <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.091 3.091zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>
          </svg>
        </div>
        <h1 class="welcome-title">Welcome to Nexus AI</h1>
        <p class="welcome-subtitle">Your advanced AI assistant powered by cutting-edge technology. Ask questions, get insights, and explore the possibilities.</p>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">
              <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                <path d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/>
              </svg>
            </div>
            <h3 class="feature-title">Smart Conversations</h3>
            <p class="feature-description">Engage in natural, contextual conversations with advanced AI understanding.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">
              <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                <path d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"/>
              </svg>
            </div>
            <h3 class="feature-title">Code Assistant</h3>
            <p class="feature-description">Get help with programming, debugging, and code optimization across multiple languages.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">
              <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
              </svg>
            </div>
            <h3 class="feature-title">Knowledge Base</h3>
            <p class="feature-description">Access vast knowledge across science, technology, arts, and more with instant responses.</p>
          </div>
        </div>
      </div>
    `;
  }
}

// Auto-resize textarea
inputField.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 200) + 'px';
});

function saveConversation() {
  if (currentConversation.length === 0) return;
  
  const existingIndex = conversations.findIndex(c => c.id === currentConversationId);
  
  const conversationData = {
    id: currentConversationId,
    title: currentConversation[0]?.content.substring(0, 50) + '...' || 'New Chat',
    timestamp: existingIndex >= 0 ? conversations[existingIndex].timestamp : Date.now(),
    lastUpdated: Date.now(),
    messages: currentConversation
  };
  
  if (existingIndex >= 0) {
    conversations[existingIndex] = conversationData;
  } else {
    conversations.unshift(conversationData);
  }
  
  if (conversations.length > 50) {
    conversations = conversations.slice(0, 50);
  }
  
  localStorage.setItem('conversations', JSON.stringify(conversations));
  localStorage.setItem('currentConversationId', currentConversationId);
  renderHistory();
}

function renderHistory() {
  historyDiv.innerHTML = '';
  
  conversations.sort((a, b) => b.lastUpdated - a.lastUpdated).forEach(conv => {
    const historyItem = document.createElement('div');
    historyItem.className = 'chat-history-item';
    if (conv.id === currentConversationId) {
      historyItem.classList.add('active');
    }
    
    const date = new Date(conv.timestamp);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    let dateStr;
    if (diffDays === 1) dateStr = 'Today';
    else if (diffDays === 2) dateStr = 'Yesterday';
    else if (diffDays <= 7) dateStr = `${diffDays - 1} days ago`;
    else dateStr = date.toLocaleDateString();
    
    historyItem.innerHTML = `
      <svg fill="currentColor" viewBox="0 0 24 24">
        <path d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/>
      </svg>
      <div class="chat-item-content">
        <div class="chat-item-title">${conv.title}</div>
        <div class="chat-item-date">${dateStr}</div>
      </div>
    `;
    
    historyItem.onclick = () => loadConversation(conv.id);
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'delete-btn';
    deleteBtn.innerHTML = '<svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>';
    deleteBtn.onclick = (e) => {
      e.stopPropagation();
      if (confirm('Delete this conversation?')) {
        deleteConversation(conv.id);
      }
    };
    
    historyItem.appendChild(deleteBtn);
    historyDiv.appendChild(historyItem);
  });
}

function loadConversation(convId) {
  if (currentConversation.length > 0) {
    saveConversation();
  }
  
  const conv = conversations.find(c => c.id === convId);
  if (conv) {
    currentConversationId = convId;
    currentConversation = [...conv.messages];
    localStorage.setItem('currentConversationId', currentConversationId);
    
    chatInner.innerHTML = '';
    currentConversation.forEach(msg => {
      addMessage(msg.content, msg.role, false);
    });
    
    renderHistory();
  }
}

function deleteConversation(convId) {
  conversations = conversations.filter(c => c.id !== convId);
  localStorage.setItem('conversations', JSON.stringify(conversations));
  
  if (convId === currentConversationId) {
    newChat();
  } else {
    renderHistory();
  }
}

function addMessage(text, sender, save = true) {
  const messageWrapper = document.createElement('div');
  messageWrapper.className = 'message-wrapper ' + sender;
  
  const message = document.createElement('div');
  message.className = 'message';
  
  const avatar = document.createElement('div');
  avatar.className = 'avatar ' + sender;
  avatar.innerHTML = sender === 'user' ? 
    '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"/></svg>' :
    '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.091 3.091z"/></svg>';
  
  const contentWrapper = document.createElement('div');
  contentWrapper.className = 'message-content-wrapper';
  
  const messageContent = document.createElement('div');
  messageContent.className = 'message-content';
  
  // Enhanced code block processing
  const processedContent = processCodeBlocks(text);
  messageContent.innerHTML = processedContent;
  
  // Highlight code blocks
  messageContent.querySelectorAll('pre code').forEach(block => {
    Prism.highlightElement(block);
  });
  
  const messageActions = document.createElement('div');
  messageActions.className = 'message-actions';
  
  const copyAction = document.createElement('button');
  copyAction.className = 'action-btn';
  copyAction.innerHTML = `
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
    </svg>
    Copy
  `;
  copyAction.onclick = () => {
    navigator.clipboard.writeText(text);
    copyAction.innerHTML = `
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
      </svg>
      Copied!
    `;
    setTimeout(() => {
      copyAction.innerHTML = `
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        Copy
      `;
    }, 2000);
  };
  
  messageActions.appendChild(copyAction);
  contentWrapper.appendChild(messageContent);
  contentWrapper.appendChild(messageActions);
  
  message.appendChild(avatar);
  message.appendChild(contentWrapper);
  messageWrapper.appendChild(message);
  
  messageWrapper.addEventListener('contextmenu', e => {
    e.preventDefault();
    if (confirm('Delete this message?')) {
      messageWrapper.remove();
      currentConversation = currentConversation.filter(m => m.content !== text || m.role !== sender);
      saveConversation();
    }
  });
  
  chatInner.appendChild(messageWrapper);
  chatInner.parentElement.scrollTop = chatInner.parentElement.scrollHeight;
  
  if (save) {
    currentConversation.push({role: sender, content: text, timestamp: Date.now()});
    saveConversation();
  }
}

function processCodeBlocks(text) {
  const codeRegex = /```(\w*)\n([\s\S]*?)```/g;
  let processedText = text;
  let match;
  const matches = [];
  
  while ((match = codeRegex.exec(text)) !== null) {
    matches.push(match);
  }
  
  matches.reverse().forEach(match => {
    const lang = match[1] || 'javascript';
    const codeText = match[2];
    const fullMatch = match[0];
    
    const codeBlock = `
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">${lang}</span>
          <button class="copy-btn" onclick="copyCode(this, \`${codeText.replace(/`/g, '\\`')}\`)">Copy</button>
        </div>
        <pre><code class="language-${lang}">${escapeHtml(codeText)}</code></pre>
      </div>
    `;
    
    processedText = processedText.replace(fullMatch, codeBlock);
  });
  
  // Process regular text (preserve line breaks)
  if (!matches.length) {
    processedText = processedText.replace(/\n/g, '<br>');
  }
  
  return processedText;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function copyCode(button, code) {
  navigator.clipboard.writeText(code);
  button.textContent = 'Copied!';
  setTimeout(() => {
    button.textContent = 'Copy';
  }, 2000);
}

function showTypingIndicator() {
  const messageWrapper = document.createElement('div');
  messageWrapper.className = 'message-wrapper ai typing-wrapper';
  messageWrapper.id = 'typing-indicator';
  
  const message = document.createElement('div');
  message.className = 'message';
  
  const avatar = document.createElement('div');
  avatar.className = 'avatar ai';
  avatar.innerHTML = '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.091 3.091z"/></svg>';
  
  const contentWrapper = document.createElement('div');
  contentWrapper.className = 'message-content-wrapper';
  
  const typingIndicator = document.createElement('div');
  typingIndicator.className = 'typing-indicator';
  typingIndicator.innerHTML = `
    <span class="typing-dot"></span>
    <span class="typing-dot"></span>
    <span class="typing-dot"></span>
  `;
  
  contentWrapper.appendChild(typingIndicator);
  message.appendChild(avatar);
  message.appendChild(contentWrapper);
  messageWrapper.appendChild(message);
  chatInner.appendChild(messageWrapper);
  chatInner.parentElement.scrollTop = chatInner.parentElement.scrollHeight;
}

function removeTypingIndicator() {
  const indicator = document.getElementById('typing-indicator');
  if (indicator) indicator.remove();
}

async function sendMessage() {
  const text = inputField.value.trim();
  if (!text || isTyping) return;
  
  // Hide welcome screen on first message
  if (currentConversation.length === 0) {
    chatInner.innerHTML = '';
  }
  
  addMessage(text, 'user');
  inputField.value = '';
  inputField.style.height = 'auto';
  
  isTyping = true;
  sendBtn.disabled = true;
  showTypingIndicator();
  
  try {
    const response = await fetch('https://apifreellm.com/api/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({message: text})
    });
    
    const data = await response.json();
    removeTypingIndicator();
    
    const aiResponse = data.status === 'success' ? data.response : (data.error || 'âŒ Sorry, I encountered an error. Please try again.');
    addMessage(aiResponse, 'ai');
  } catch (err) {
    removeTypingIndicator();
    addMessage('âš ï¸ Connection error. Please check your internet connection and try again.', 'ai');
  } finally {
    isTyping = false;
    sendBtn.disabled = false;
  }
}

inputField.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

function toggleTheme() {
  document.body.classList.toggle('light');
  const themeText = document.getElementById('theme-text');
  themeText.textContent = document.body.classList.contains('light') ? 'Dark Mode' : 'Light Mode';
  localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
}

function toggleSidebar() {
  sidebar.classList.toggle('open');
  overlay.classList.toggle('show');
}

function newChat() {
  if (currentConversation.length > 0) {
    saveConversation();
  }
  
  currentConversationId = generateId();
  currentConversation = [];
  localStorage.setItem('currentConversationId', currentConversationId);
  
  chatInner.innerHTML = '';
  showWelcomeScreen();
  renderHistory();
  
  if (window.innerWidth <= 768) {
    toggleSidebar();
  }
}

function clearAll() {
  if (confirm('ðŸ—‘ï¸ Delete all chat history? This action cannot be undone.')) {
    conversations = [];
    currentConversation = [];
    currentConversationId = generateId();
    localStorage.setItem('conversations', JSON.stringify(conversations));
    localStorage.setItem('currentConversationId', currentConversationId);
    chatInner.innerHTML = '';
    showWelcomeScreen();
    renderHistory();
  }
}

function exportChat() {
  if (currentConversation.length === 0) {
    alert('No messages to export!');
    return;
  }
  
  const chatText = currentConversation
    .map(msg => `${msg.role.toUpperCase()}: ${msg.content}`)
    .join('\n\n');
    
  const blob = new Blob([chatText], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `nexus-chat-${new Date().toISOString().split('T')[0]}.txt`;
  a.click();
  URL.revokeObjectURL(url);
}

// Load saved theme
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'light') {
  document.body.classList.add('light');
  document.getElementById('theme-text').textContent = 'Dark Mode';
}

// Mobile menu style
const style = document.createElement('style');
style.textContent = '@media (min-width: 769px) { .mobile-menu { display: none !important; } }';
document.head.appendChild(style);

// Initialize
showWelcomeScreen();
renderHistory();

// Add smooth scrolling
document.documentElement.style.scrollBehavior = 'smooth';
</script>
</body>
</html>